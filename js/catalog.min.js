/*! @license Copyright (c) 161 SARL, https://161.io */
+function(a){"use strict";function t(a){a=(""+a).replace(",",".");var t=parseFloat(a);return(isNaN(t)||t<0)&&(t=0),t}function e(a){return a.toFixed(2).replace(".",",")}function d(a){a=t(a),r.html(e(a))}function n(t,e){(t=a.extend({action:f,id:0,type:""},t)).id=parseInt(t.id);var n=l.find('[data-product="'+t.id+'"]');if(!n.length)return void alert("Product not found : "+t.id);var r=n.find(".label-state"),s=a.ajax({url:l.data("url-import"),type:"POST",cache:!1,data:t,dataType:"json"});s.done(function(t){if(t.success){var o=t.type,l=n.find('.btn[data-type="'+o+'"]');return l.removeClass("btn-default").addClass("btn-success").data("credit",0),o==u||n.find(".btn[data-type].btn-success").length>1?n.find(".btn[data-type]").removeClass("btn-default").addClass("btn-success").data("credit",0):n.find('.btn[data-type="full"]').data("credit",l.data("init-credit")),i(r,"success",r.data("msg-done")),d(t.apiResponse.credit),void(e&&e())}i(r,"danger"),t.apiResponse&&(d(t.apiResponse.credit),t.apiResponse.error&&a.growl.error({title:"",size:"large",message:t.apiResponse.error.message||"Message not found"}))}),s.fail(function(a){i(r,"danger")}),s.always(function(){o()||n.find("button").prop("disabled",!1).attr("disabled","")}),i(r,"default",r.data("msg-progress")),n.find("button").prop("disabled",!0).attr("disabled","disabled")}function i(a,t,e){return"danger"!=t||e||(e="Error"),a.removeClass("label-default label-danger label-success").addClass("label-"+t).html(e)}function o(){return b}var r,l,s,c,u="full",f="edit",p="&euro;",b=!1;a(function(){r=a("#labodata-credit"),l=a("#labodata-result"),s=a("#modal-labodata-import"),c=a("#modal-labodata-credit"),p=a("#labodata-currency").html(),l.find("[data-type][title]").tooltip({container:l}),c.find('[data-submit="modal"]').on("click",function(){window.location.href=a("#labodata-autopay").attr("href")}),l.find("tbody .btn[data-credit]").on("click",function(){var e=a(this),d=e.parents("tr[data-product]"),i=e.data("type"),o=t(e.data("credit")),u=!o;e.tooltip("hide");var b=s.attr("id")+"-clone";if(a("#"+b).remove(),!u&&o>t(r.text()))return void c.modal("show");if(u&&"buy"==f&&Cookies.set("LaboDataModalIgnore",!1),"true"==Cookies.get("LaboDataModalIgnore"))return void n({id:d.data("product"),type:i});var m=d.find("[data-prod-title]").html(),h=e.data("credit")+p,g=s.clone();g.attr("id",b),g.find('[data-bought="'+(u?"0":"1")+'"]').addClass("hide"),g.find("[data-type]").not('[data-type="'+i+'"]').addClass("hide"),g.find('[data-val="title"]').html(m),g.find('[data-val="price"]').html(h),g.find('[data-submit="modal"]').on("click",function(){f=g.find('[name="modal-action"]:checked').val();var a=g.find('[name="modal-ignore"]').prop("checked");Cookies.set("LaboDataModalIgnore",a),n({id:d.data("product"),type:i}),g.modal("hide")}),g.insertAfter(l).modal("show")})})}(jQuery);