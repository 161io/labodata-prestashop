/*! @license Copyright (c) 161 SARL, https://161.io */
+function(a){"use strict";function b(a){a=(""+a).replace(",",".");var b=parseFloat(a);return(isNaN(b)||b<0)&&(b=0),b}function c(a){return a.toFixed(2).replace(".",",")}function d(a){a=b(a),h.html(c(a))}function e(b,c){b=a.extend({action:m,id:0,type:""},b),b.id=parseInt(b.id);var e=i.find('[data-product="'+b.id+'"]');if(!e.length)return void alert("Product not found : "+b.id);var h=e.find(".label-state"),j=a.ajax({url:i.data("url-import"),type:"POST",cache:!1,data:b,dataType:"json"});j.done(function(b){if(b.success){var g=b.type,i=e.find('.btn[data-type="'+g+'"]');return i.removeClass("btn-default").addClass("btn-success").data("credit",0),g==l||e.find(".btn[data-type].btn-success").length>1?e.find(".btn[data-type]").removeClass("btn-default").addClass("btn-success").data("credit",0):e.find('.btn[data-type="full"]').data("credit",i.data("init-credit")),f(h,"success",h.data("msg-done")),d(b.apiResponse.credit),void(c&&c())}f(h,"danger"),b.apiResponse&&(d(b.apiResponse.credit),b.apiResponse.error&&a.growl.error({title:"",size:"large",message:b.apiResponse.error.message||"Message not found"}))}),j.fail(function(a){f(h,"danger")}),j.always(function(){g()||e.find("button").prop("disabled",!1).attr("disabled","")}),f(h,"default",h.data("msg-progress")),e.find("button").prop("disabled",!0).attr("disabled","disabled")}function f(a,b,c){return"danger"!=b||c||(c="Error"),a.removeClass("label-default label-danger label-success").addClass("label-"+b).html(c)}function g(){return o}var h,i,j,k,l="full",m="edit",n="&euro;",o=!1;a(function(){h=a("#labodata-credit"),i=a("#labodata-result"),j=a("#modal-labodata-import"),k=a("#modal-labodata-credit"),n=a("#labodata-currency").html(),i.find("[data-type][title]").tooltip({container:i}),k.find('[data-submit="modal"]').on("click",function(){window.location.href=a("#labodata-autopay").attr("href")}),i.find("tbody .btn[data-credit]").on("click",function(){var c=a(this),d=c.parents("tr[data-product]"),f=c.data("type"),g=b(c.data("credit")),l=!g;c.tooltip("hide");var o=j.attr("id")+"-clone";if(a("#"+o).remove(),!l&&g>b(h.text()))return void k.modal("show");if(l&&"buy"==m&&Cookies.set("LaboDataModalIgnore",!1),"true"==Cookies.get("LaboDataModalIgnore"))return void e({id:d.data("product"),type:f});var p=d.find("[data-prod-title]").html(),q=c.data("credit")+n,r=j.clone();r.attr("id",o),r.find('[data-bought="'+(l?"0":"1")+'"]').addClass("hide"),r.find("[data-type]").not('[data-type="'+f+'"]').addClass("hide"),r.find('[data-val="title"]').html(p),r.find('[data-val="price"]').html(q),r.find('[data-submit="modal"]').on("click",function(){m=r.find('[name="modal-action"]:checked').val();var a=r.find('[name="modal-ignore"]').prop("checked");Cookies.set("LaboDataModalIgnore",a),e({id:d.data("product"),type:f}),r.modal("hide")}),r.insertAfter(i).modal("show")})})}(jQuery);