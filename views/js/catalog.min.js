/*! @license Copyright (c) 161 SARL, https://161.io */
+function(t){"use strict";function a(t){t=(""+t).replace(",",".");var a=parseFloat(t);return(isNaN(a)||a<0)&&(a=0),a}function e(t){return t.toFixed(2).replace(".",",")}function d(t){t=a(t),c.html(e(t))}function o(a,e){(a=t.extend({action:g,id:0,type:""},a)).id=parseInt(a.id);var o=u.find('[data-product="'+a.id+'"]');if(!o.length)return void alert("Product not found : "+a.id);var l=o.find(".label-state"),c=t.ajax({url:u.data("url-import"),type:"POST",cache:!1,data:a,dataType:"json"});c.done(function(a){if(a&&a.success){var n=a.type,c=o.find('.btn[data-type="'+n+'"]');return c.removeClass("btn-default").addClass("btn-success").data("credit",0),n==m||o.find(".btn[data-type].btn-success").length>1?o.find(".btn[data-type]").removeClass("btn-default").addClass("btn-success").data("credit",0):o.find('.btn[data-type="full"]').data("credit",c.data("init-credit")),i(l,"success",s.stateDone),d(a.apiResponse.credit),void(e&&e())}i(l,"danger"),a&&a.apiResponse?(d(a.apiResponse.credit),a.apiResponse.error&&t.growl.error({title:"",size:"large",message:a.apiResponse.error.message||s.errorInternal})):t.growl.error({title:"",size:"large",message:s.errorInternal}),r(!1,!0)}),c.fail(function(t){i(l,"danger"),r(!1,!0)}),c.always(function(){n()||o.find("button").prop("disabled",!1).attr("disabled","")}),i(l,"default",s.stateProgress),o.find("button").prop("disabled",!0).attr("disabled","disabled")}function i(t,a,e){return"danger"!=a||e||(e="Error"),t.removeClass("label-default label-danger label-success").addClass("label-"+a).html(e)}function n(){return v}function r(t,a){(v=!!t)?(u.find("tbody .btn[data-type]").prop("disabled",!0),window.onbeforeunload=function(t){var a=s.importGroupExit;return(t=t||window.event)&&(t.returnValue=a),a}):(u.find("tbody .btn[data-type]").prop("disabled",!0),window.onbeforeunload=null,a&&u.find("tbody .label-state").html("Error"))}function l(){var a=u.find("tbody .btn.waiting").first();if(!a.length)return r(!1),void t.growl.notice({title:"",size:"large",message:s.importGroupDone});a.removeClass("waiting");var e=a.parents("[data-product]");i(e.find(".label-state"),"default",s.stateProgress),o({id:parseInt(e.data("product")),type:a.data("type")},l)}var s,c,u,f,p,b,m="full",g="edit",h="&euro;",v=!1;t(function(){s=window.LaboDataTranslate,c=t("#labodata-credit"),u=t("#labodata-result"),f=t("#modal-labodata-import"),p=t("#modal-labodata-import-group"),b=t("#modal-labodata-credit"),h=t("#labodata-currency").html(),u.find("[data-type][title]").tooltip({container:u}),b.find('[data-submit="modal"]').on("click",function(){window.location.href=t("#labodata-autopay").attr("href")}),u.find("tbody .btn[data-credit]").on("click",function(){var e=t(this),d=e.parents("tr[data-product]"),i=e.data("type"),n=a(e.data("credit")),r=!n;e.tooltip("hide");var l=f.attr("id")+"-clone";if(t("#"+l).remove(),!r&&n>a(c.text()))return void b.modal("show");if(r&&"buy"==g&&Cookies.set("LaboDataModalIgnore",!1),"true"==Cookies.get("LaboDataModalIgnore"))return void o({id:d.data("product"),type:i});var s=d.find("[data-prod-title]").html(),p=e.data("credit")+h,m=f.clone();m.attr("id",l),m.find('[data-bought="'+(r?"0":"1")+'"]').addClass("hide"),m.find("[data-type]").not('[data-type="'+i+'"]').addClass("hide"),m.find('[data-val="title"]').html(s),m.find('[data-val="price"]').html(p),m.find('[data-submit="modal"]').on("click",function(){g=m.find('[name="modal-action"]:checked').val();var t=m.find('[name="modal-ignore"]').prop("checked");Cookies.set("LaboDataModalIgnore",t),o({id:d.data("product"),type:i}),m.modal("hide")}),m.insertAfter(u).modal("show")}),t("#labodata-import-group .btn[data-type]").on("click",function(){if(n())return void t.growl.warning({title:"",size:"large",message:s.importGroupProgress});var d=t(this),o=d.data("type"),f=u.find('tbody .btn[data-type="'+o+'"]'),m=0;f.each(function(){m+=a(t(this).data("credit"))});var g=!m;d.tooltip("hide");var v=p.attr("id")+"-clone";if(t("#"+v).remove(),!g&&m>a(c.text()))return void b.modal("show");var y=p.clone();y.attr("id",v),y.find('[data-bought="'+(g?"0":"1")+'"]').addClass("hide"),y.find("[data-type]").not('[data-type="'+o+'"]').addClass("hide"),y.find('[data-val="product"]').html(f.length),y.find('[data-val="credit"]').html(e(m)+h),y.find('[data-submit="modal"]').on("click",function(){r(!0),f.addClass("waiting"),i(u.find("tbody .label-state"),"default",s.stateWait),y.modal("hide"),l()}),y.insertAfter(u).modal("show")})})}(jQuery);