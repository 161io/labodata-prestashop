/**
 * LaboData for Prestashop
 *
 * @author 161 SARL <contact@161.io>
 * @copyright (c) 161 SARL, https://161.io
 * @license https://161.io
 */
!function(l){"use strict";var d;function c(a){l("#ajax_running").css("display",a?"":"none")}function p(a,t){l.growl.notice({title:a,size:"large",message:t})}function f(a,t){l.growl.error({title:a,size:"large",message:t})}function u(a,t){var e="disabled";t?a.prop(e,!0).attr(e,e):a.prop(e,!1).removeAttr(e)}var v=!1;function t(e,n){var a=e.data("xhr");a||(c(!0),(a=l.ajax({url:e.data("action"),type:"POST",dataType:"json"})).done(function(a){var t;"notice"===a.growlType?(u(e,!0),a.psIdObject&&((t=l('[name="id_prestashop_'+a.id+'"]')).val(a.psIdObject),t.parent().next().text(a.psNameObject),a.ldCategory.parent_id&&(u((t=l('[name="id_prestashop_'+a.ldCategory.parent_id+'"]')).parent().parent().find(".btn"),!0),t.val(a.psIdParentObject),t.parent().next().text(a.psNameParentObject))),p("",a.growlMessage),n&&n()):(v=!1,f("",a.growlMessage||"Message not found"))}),a.fail(function(){v=!1,f(d.errorTitle,d.errorMessage)}),a.always(function(){a=null,e.data("xhr",a),c(!1)}),e.data("xhr",a))}function e(){var a=l(".btn[data-action]").not("[disabled]").first();a.length?(c(v=!0),t(a,e)):(u(l("#btn-add-all"),!0),v=!1)}l(function(){d=window.LaboDataTranslate,l(".table.configuration").find("td.pointer").removeAttr("onclick").removeClass("pointer"),l("#btn-add-all").on("click",function(){return!v&&void(confirm(l(this).data("confirm"))&&e())}),l(".btn[data-action]").on("click",function(){return v||t(l(this)),!1}),l("input.id_prestashop").each(function(){var a=l(this);a.data("prevVal",a.val())}).on("change.labodata",function(){!function(e){var a=e.parents("form"),t=e.parent().parent(),n=t.children().first(),r=t.children().eq(3),i=t.find(".btn"),o=parseInt(n.text());if(isNaN(o)||o<0)e.val(e.data("prevVal"));else{t=""===e.val()?-1:parseInt(e.val());if(-1===t)e.val("");else{if(isNaN(t)||t<1)return e.val(e.data("prevVal"));e.val(t)}n=i.data("action").replace(/^(.+action=add)(\w+)$/i,"bind$2");u(e.add(i),!0),c(!0);var s=l.ajax({url:a.data("action"),type:"POST",data:{action:n,id:o,idPrestashop:t},dataType:"json"});s.done(function(a){var t=!1;-1==a.psIdObject?(t=!0,r.text(""),u(i,!1)):a.psIdObject&&0<a.psIdObject&&(t=!0,r.text(a.psNameObject)),t?(e.data("prevVal",e.val()),a.growlMessage&&p("",a.growlMessage)):(e.val(e.data("prevVal")),""===e.val()&&u(i,!1),a.growlMessage&&f("",a.growlMessage))}),s.fail(function(){v=!1,f(d.errorTitle,d.errorMessage)}),s.always(function(){s=null,u(e,!1),c(!1)})}}(l(this))})})}(jQuery);