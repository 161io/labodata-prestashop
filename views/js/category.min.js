/**
 * LaboData for Prestashop
 *
 * @author 161 SARL <contact@161.io>
 * @copyright (c) 161 SARL, https://161.io
 * @license https://161.io
 */
!function(c){"use strict";var p;function f(a){c("#ajax_running").css("display",a?"":"none")}function u(a,t){c.growl.notice({title:a,size:"large",message:t})}function v(a,t){c.growl.error({title:a,size:"large",message:t})}function g(a,t){var e="disabled";t?a.prop(e,!0).attr(e,e):a.prop(e,!1).removeAttr(e)}var b=!1;function a(){return b}function t(n,r){var a=n.data("xhr");return a||(f(!0),(a=c.ajax({url:n.data("action"),type:"POST",dataType:"json"})).done(function(a){switch(a.growlType){case"notice":if(g(n,!0),a.psIdObject){var t=c('[name="id_prestashop_'+a.id+'"]');if(t.val(a.psIdObject),t.parent().next().text(a.psNameObject),a.ldCategory.parent_id){var e=c('[name="id_prestashop_'+a.ldCategory.parent_id+'"]');g(e.parent().parent().find(".btn"),!0),e.val(a.psIdParentObject),e.parent().next().text(a.psNameParentObject)}}u("",a.growlMessage),r&&r();break;default:b=!1,v("",a.growlMessage||"Message not found")}}),a.fail(function(){b=!1,v(p.errorTitle,p.errorMessage)}),a.always(function(){a=null,n.data("xhr",a),f(!1)}),n.data("xhr",a)),!1}function e(){var a=c(".btn[data-action]").not("[disabled]").first();a.length?(f(b=!0),t(a,e)):(g(c("#btn-add-all"),!0),b=!1)}c(function(){p=window.LaboDataTranslate,c(".table.configuration").find("td.pointer").removeAttr("onclick").removeClass("pointer"),c("#btn-add-all").on("click",function(){if(a())return!1;confirm(c(this).data("confirm"))&&e()}),c(".btn[data-action]").on("click",function(){return a()||t(c(this)),!1}),c("input.id_prestashop").each(function(){var a=c(this);a.data("prevVal",a.val())}).on("change.labodata",function(){!function(e){var a=e.parents("form"),t=e.parent().parent(),n=t.children().first(),r=t.children().eq(3),i=t.find(".btn"),o=parseInt(n.text());if(isNaN(o)||o<0)e.val(e.data("prevVal"));else{var s=""===e.val()?-1:parseInt(e.val());if(-1===s)e.val("");else{if(isNaN(s)||s<1)return e.val(e.data("prevVal"));e.val(s)}var l=i.data("action").replace(/^(.+action=add)(\w+)$/i,"bind$2");g(e.add(i),!0),f(!0);var d=c.ajax({url:a.data("action"),type:"POST",data:{action:l,id:o,idPrestashop:s},dataType:"json"});d.done(function(a){var t=!1;-1==a.psIdObject?(t=!0,r.text(""),g(i,!1)):a.psIdObject&&0<a.psIdObject&&(t=!0,r.text(a.psNameObject)),t?(e.data("prevVal",e.val()),a.growlMessage&&u("",a.growlMessage)):(e.val(e.data("prevVal")),""===e.val()&&g(i,!1),a.growlMessage&&v("",a.growlMessage))}),d.fail(function(){b=!1,v(p.errorTitle,p.errorMessage)}),d.always(function(){d=null,g(e,!1),f(!1)})}}(c(this))})})}(jQuery);